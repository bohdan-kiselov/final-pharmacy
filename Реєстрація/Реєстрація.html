<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pharmacy</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Irish+Grover&display=swap');

    .wrapper {
      position: relative;
      width: 1440px;
      height: 900px;
      background: white;
      overflow: hidden;
      margin: 0 auto;
    }

    .logo-img {
       position: absolute;
  top: 30px;
  left: 48px;
  width: 200px; /* або будь-який потрібний розмір */
  height: auto;
    }

    .header-img {
      position: absolute;
      top: 0;
      left: 299px;
      width: 1127px;
      height: 84px;
      object-fit: cover;
    }

    .footer-img {
      position: absolute;
      top: 805px;
      left: 18px;
      width: 1145px;
      height: 95px;
      object-fit: cover;
    }

    .btn-register {
      position: absolute;
      top: 805px;
      left: 1208px;
      width: 220px;
      height: 87px;
      background: #D9D9D9;
      border-radius: 65px;
      border: 1px solid black;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-family: 'Inter', sans-serif;
      cursor: not-allowed;
    }

    .title-main {
      position: absolute;
      top: 19.6px;
      left: 76.3px;
      font-family: 'Irish Grover', cursive;
      font-size: 40px;
    }

    .title-form {
      position: absolute;
      top: 143px;
      left: 107px;
      font-size: 24px;
      text-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
    }

    .form-group {
      position: absolute;
      left: 58px;
      display: flex;
      flex-direction: column;
      width: 845px;
      gap: 18px;
      top: 200px;
    }

    .form-row {
      display: flex;
      flex-direction: column;
      font-size: 24px;
    }

    .form-row input {
      height: 41.42px;
      background: #E9E9E9;
      border-radius: 59px;
      border: 1px solid black;
      padding-left: 15px;
      font-size: 18px;
    }

    .form-note-required {
      position: absolute;
      top: 750px;
      left: 160px;
      color: red;
      font-size: 16px;
    }

    .error {
      color: red;
      font-size: 14px;
      margin-top: 4px;
      margin-left: 10px;
    }

    .modal {
  display: none; /* Приховано за замовчуванням */
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
  padding-top: 60px;
}

.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  max-width: 600px;
  border-radius: 10px;
  text-align: center;
}

.close-btn {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.close-btn:hover,
.close-btn:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.success-message {
  color: #155724;
  background-color: #d4edda;
  border-color: #c3e6cb;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 15px;
}

.error-message {
  color: #721c24;
  background-color: #f8d7da;
  border-color: #f5c6cb;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 15px;
}

.message {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #ffdddd;
    color: #b80000;
    padding: 15px 20px;
    border-radius: 5px;
    z-index: 9999;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    font-size: 16px;
    font-family: sans-serif;
}

.message.success {
    background-color: #ddffdd;
    color: #008000;
}

.message.error {
    background-color: #ffdddd;
    color: #b80000;
}

  </style>
</head>
<body>

  <div class="wrapper">
    <img src="https://www.rbc.ua/static/img/p/i/pixabay_lekarstvo_300677bf84ce84ff6d4130d32778d6d8_650x410.jpg" class="header-img" alt="Заголовок">
    <img src="https://www.rbc.ua/static/img/p/i/pixabay_lekarstvo_300677bf84ce84ff6d4130d32778d6d8_650x410.jpg" class="footer-img" alt="Підвал">

    <!-- ЗРОБЛЕНО КЛІКАБЕЛЬНИМ -->
      <!-- !!!!!ТУТ НАТ ГЛАВНУЮ  -->
    <a href="">
      <img src="https://raw.githubusercontent.com/bohdan-kiselov/final-pharmacy/Front/проект/картинки/лого1.png" class="logo-img" alt="Лого">
    </a>

    
    <div class="title-form">Реєстрація</div>

    <div class="form-group">
      <div class="form-row">
        <label for="login">Login*</label>
        <input id="login" type="text" placeholder="Введіть логін">
        <div class="error" id="error-login"></div>
      </div>
      <div class="form-row">
        <label for="phone">Телефон*</label>
        <input id="phone" type="text" placeholder="Введіть номер телефону">
        <div class="error" id="error-phone"></div>
      </div>
      <div class="form-row">
        <label for="email">Почта*</label>
        <input id="email" type="text" placeholder="Введіть email">
        <div class="error" id="error-email"></div>
      </div>
      <div class="form-row">
        <label for="pass">Пароль*</label>
        <input id="pass" type="password" placeholder="Введіть пароль">
        <div class="error" id="error-pass"></div>
      </div>
      <div class="form-row">
        <label for="confirm-pass">Підтвердження паролю*</label>
        <input id="confirm-pass" type="password" placeholder="Підтвердження паролю">
        <div class="error" id="error-confirm"></div>
      </div>
    </div>

    <div class="form-note-required">Всі поля з позначкою “*” повинні бути заповненні</div>

    <div id="btn-register" class="btn-register" >Зареєструватись</div>
  </div>
  <div id="modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <div id="modal-message"></div>
  </div>
</div>

  <!-- Усі стилі залишаються, тільки скрипт змінено -->
<script src="script.js"></script>
<script>
 
 function checkInputs() {
    const login = document.getElementById('login').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const email = document.getElementById('email').value.trim();
    const pass = document.getElementById('pass').value;
    const confirmPass = document.getElementById('confirm-pass').value;
    
    let valid = true;

    // Перевірка логіну
    if (login.length < 3 || login.length > 16) {
        showError('error-login', 'Логін має містити від 3 до 16 символів');
        valid = false;
    } else {
        showError('error-login', '');
    }

    // Перевірка телефону
    if (!/^\+380\d{9}$/.test(phone)) {
        showError('error-phone', 'Номер має починатися з +380 і містити 13 символів');
        valid = false;
    } else {
        showError('error-phone', '');
    }

    // Перевірка email
    if (!/^[a-zA-Z0-9._%+-]+@gmail\.com$/.test(email)) {
        showError('error-email', 'Введіть дійсну адресу Gmail');
        valid = false;
    } else {
        showError('error-email', '');
    }

    // Перевірка паролю
    if (!/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{8,16}$/.test(pass)) {
        showError('error-pass', 'Пароль має містити латинські літери та цифри, від 8 до 16 символів');
        valid = false;
    } else {
        showError('error-pass', '');
    }

    // Підтвердження паролю
    if (pass !== confirmPass || confirmPass === '') {
        showError('error-confirm', 'Паролі не збігаються');
        valid = false;
    } else {
        showError('error-confirm', '');
    }

    // Увімкнення або блокування кнопки
    const btn = document.getElementById('btn-register');
   if (valid) {
    btn.removeAttribute('disabled');
    btn.style.cursor = 'pointer';
} else {
    btn.setAttribute('disabled', 'disabled');
    btn.style.cursor = 'not-allowed';
}

}

function showError(id, message) {
    const errorElement = document.getElementById(id);
    errorElement.textContent = message;
}

function showNotification(message, type = 'error') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.classList.add(type);
    notification.style.display = 'block';
    setTimeout(() => {
        notification.style.display = 'none';
        notification.classList.remove(type);
    }, 5000);
}
function showMessage(message, type) {
    const msgBox = document.createElement('div');
    msgBox.className = type === "success" ? "success-message" : "error-message";
    msgBox.textContent = message;
    document.body.prepend(msgBox);

    setTimeout(() => {
        msgBox.remove();
    }, 5000);
}

async function fetchWithAuth(url, options = {}) {
    const token = localStorage.getItem('authToken');
    if (!token) {
        alert('Токен не знайдено. Будь ласка, увійдіть у систему.');
        window.location.href = ''; //...ТУТ НА ГЛАВНУЮ
        return;
    }

    const headers = options.headers || {};
    headers['Authorization'] = `Bearer ${token}`;
    options.headers = headers;

    const response = await fetch(url, options);
    return response;
}

// Додавання подій для валідації під час введення
['login', 'phone', 'email', 'pass', 'confirm-pass'].forEach(id => 
    document.getElementById(id).addEventListener('input', checkInputs)
);

// Обробка кліку на кнопку реєстрації
document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById('btn-register');

    btn.addEventListener('click', async () => {
        if (btn.getAttribute('disabled') !== null) return;

        const userData = {
            login: document.getElementById('login').value.trim(),
            phone: document.getElementById('phone').value.trim(),
            email: document.getElementById('email').value.trim(),
            password: document.getElementById('pass').value
        };

        try {
            const response = await fetch('https://localhost:7234/User/api/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            });

            if (response.ok) {
                const data = await response.json();

                // Збереження токена
                const token = data.token;
                if (token) {
                    localStorage.setItem('authToken', token);
                    showMessage("Ви успішно зареєструвалися! Токен збережено.", "success");
                } else {
                    showMessage("Реєстрація успішна, але токен не отримано.", "error");
                }
            } else {
                const data = await response.json();
                showMessage(data.message || 'Невідома помилка', "error");
            }
        } catch (error) {
            showMessage('Не вдалося з’єднатись із сервером', "error");
        }
    });
});

function showMessage(message, type) {
    const modal = document.getElementById("modal");
    const messageBox = document.getElementById("modal-message");
    const modalContent = `
        <div class="${type === "success" ? "success-message" : "error-message"}">
            ${message}
        </div>
        <button onclick="closeModal()">Закрити</button>
    `;
    messageBox.innerHTML = modalContent;
    modal.style.display = "block";
}

function closeModal() {
    const modal = document.getElementById("modal");
    modal.style.display = "none";



    // Закриття модального вікна
    const closeBtn = document.querySelector(".close-btn");
    closeBtn.onclick = () => {
        modal.style.display = "none";
    };

    // Закриття при кліку поза вікном
    window.onclick = (event) => {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    };
}


</script>


</body>
</html>
